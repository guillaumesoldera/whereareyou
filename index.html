<html>
    <head>
        <meta charset="UTF-8"/>
        <title>Where are you ?</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
        <meta name="description" content="Perdu sur les pistes ? T'as perdu tes copains ? C'est bon t'es sauvé !">
        <!--<link rel="shortcut icon" type="image/png" href="/images/favicon.ico">
        <link rel="apple-touch-icon" type="image/png" href="/images/apple-touch-icon.png">-->
        <link rel="stylesheet" href="./styles/main.css"/>
        <link rel="stylesheet" href="./styles/leaflet.css"/>
    </head>
    <body>
        <div id="map"></div>
        <script>
            function loadMap() {
                var userPositionIcon = L.divIcon({
                   // html: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="36" viewBox:"0 0 24 36><circle cx="12" cy="24" r="12" fill="#FF0000"/></svg>',
                    //html: '<svg width="27" height="41" viewBox="0 0 27 27" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="13.5" cy="13.5" r="13.5" fill="currentColor" fill-opacity="0.2"></circle><circle cx="13.4992" cy="13.4997" r="9.84586" fill="currentColor" fill-opacity="0.4"></circle><circle cx="13.5015" cy="13.4996" r="5.78572" fill="currentColor" fill-opacity="0.8"></circle></svg>',
                    html: '<svg width="27" height="41" viewBox="0 0 27 27" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="13.5" cy="13.5" r="13.5" fill="currentColor" fill-opacity="0.4"></circle><circle cx="13.4992" cy="13.4997" r="9.84586" fill="currentColor" fill-opacity="0.6"></circle><circle cx="13.5015" cy="13.4996" r="5.78572" fill="currentColor" fill-opacity="1.0"></circle></svg>',
                    className: "blink user-position",
                    iconSize: [27, 41],
                    iconAnchor: [13, 20],
                })
                L.Control.Geoloc = L.Control.extend({
                    onAdd: (mapRef) => {
                        var container = L.DomUtil.create('div', 'leaflet-bar')
                        var button = L.DomUtil.create('button', 'geoloc-button', container)
                        button.innerHTML = '<img src="./images/locate.svg" alt="Locate me!">';
                        button.onclick = () => {
                            mapRef.locate();
                            button.classList.add("disabled");
                            button.disabled = true
                            var loader = L.DomUtil.create('div', 'loader', button)
                            mapRef.on('locationfound', (locEvent) => {
                                var radius = locEvent.accuracy / 2
                                console.log(radius)
                                var point = locEvent.latlng
                                mapRef.setView(point, 16)
                                button.disabled = false;
                                button.classList.remove("disabled");
                                loader.remove();
                                L.marker(point,{icon:userPositionIcon}).bindPopup('You are here!').addTo(map)
                                //L.circle(point, radius).addTo(mapRef).bindPopup('Vous êtes vers là').openPopup()
                            })
                            mapRef.on('locationerror', (err) => {
                                button.disabled = false;
                            })
                        }
                        return container;
                    }
                })

                L.control.geoloc = (opts) => {
                    return new L.Control.Geoloc(opts);
                }

                var centaure = [45.510236396660524, 6.707424420625342]
                var map = L.map('map').setView([45.5085, 6.7075], 16);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; OpenStreetMap | &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 18
                }).addTo(map);
                L.tileLayer('https://tile.waymarkedtrails.org/slopes/{z}/{x}/{y}.png', {
                    maxZoom: 18,
                    opacity: 0.7
                }).addTo(map);
                L.marker(centaure).bindPopup('Centaure').addTo(map);
                var geolocButton = L.control.geoloc({position: 'topleft'})
                geolocButton.addTo(map)
            }
        </script>
        <script src="./javascripts/leaflet.js" onload="loadMap()"></script>
    </body>
</html>